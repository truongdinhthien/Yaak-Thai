console.log("Welcome to YAAKTHAI");const $btnShowCart=$(".cart-button"),$btnCloseCart=$(".cart-close"),$btnAddToCart=$(".order-button"),$inputQuantity=$("input.quantity"),$cartQuantityBadge=$(".cart-quantity"),$totalPriceCartEle=$(".cart-total-top .text-18.bold"),$cartListEle=$(".cart-list");function numberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function parseToNumber(t){return+t||t}function isEmpty(t){return null==t||"object"==typeof t&&0===Object.keys(t).length||"string"==typeof t&&0===t.trim().length}function sum(t,e){return t.reduce(((t,a)=>+t+(e?+a[e]:+a)),0)}function fetchProducts(){const t=new DOMParser;return fetch("/ajax-product-collection").then((t=>t.text())).then((e=>{const a=t.parseFromString(e,"text/html");products=[...a.querySelectorAll(".w-dyn-item")].map((t=>[...t.querySelectorAll("[data-prop]")].reduce(((t,e)=>({...t,[e.dataset.prop]:e.src||parseToNumber(e.innerText)||null})),{})))}))}function getProductById(t){return products.find((e=>e.id===t))||{}}const defaultCartData={totalAfterPrice:0,totalQuantity:0,data:[]};function getCart(){const t=JSON.parse(localStorage.getItem("cart"));return isEmpty(t)?(localStorage.setItem("cart",JSON.stringify(defaultCartData)),defaultCartData):t}function setCart(t){const e={totalQuantity:sum(t,"quantity"),totalAfterPrice:sum(t,"totalAfterPrice"),data:t};localStorage.setItem("cart",JSON.stringify(e))}function addItemToCart(t,e){const a=getCart().data,r=a.find((e=>e.id===t));if(r){const t=r.quantity+e;return r.quantity=t,r.totalAfterPrice=r.afterPrice*t,void setCart(a)}const n=getProductById(t),o={...n,quantity:e,totalAfterPrice:n.afterPrice*e};setCart([...a,o])}function removeItemFromCart(t){const e=getCart().data.filter((e=>e.id!==t));console.log(e),setCart(e)}function renderCartItem(t){const{name:e,totalAfterPrice:a,image:r,id:n}=t;return`<div class="cart-item">\n        <img\n          src=${r}\n          loading="lazy"\n          alt=""\n          class="cart-item-img"\n        />\n        <div class="cart-item-info">\n          <div class="heading-3 bold">${e}</div>\n          <div class="heading-3">${numberWithCommas(a)} VND</div>\n          <a href="#" class="cart-item-remove" data-id=${n}>Remove</a>\n        </div>\n      </div>`}function renderCart(){const t=getCart(),e=t.data.map(renderCartItem);$totalPriceCartEle.text(`${numberWithCommas(t.totalAfterPrice)} VND`),$cartQuantityBadge.text(t.totalQuantity),$cartListEle.html(e.join(" ")),$(".cart-item-remove").on("click",(function(t){t.preventDefault();removeItemFromCart($(this).data("id")),renderCart()}))}function handleCartVisible(){$btnShowCart.on("click",(t=>{t.preventDefault(),$(".cart-wrap, .cart-container").addClass("show")})),$btnCloseCart.on("click",(t=>{t.preventDefault(),$(".cart-wrap, .cart-container").removeClass("show")}))}function handleAddToCart(){$btnAddToCart.on("click",(function(t){t.preventDefault();const e=$(this).closest(".add-to-cart").find($inputQuantity).val();addItemToCart($(this).data("id"),+e),renderCart()}))}renderCart(),handleCartVisible(),handleAddToCart(),window.onload=()=>{fetchProducts().then((()=>{console.log(products)}))};
